(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-480b7ac3"],{"028a":function(e,t,i){"use strict";var a=i("2e88"),n=i.n(a);n.a},"2e88":function(e,t,i){},"898e":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"text-align":"center","padding-top":"10px"}},[i("van-nav-bar",{attrs:{title:e.title,"left-arrow":"","left-text":"返回",fixed:!0,border:!0},on:{"click-left":e.onClickLeft}}),i("div",{staticStyle:{"margin-top":"2.2rem"}},[e._l(e.round,(function(t,a){return i("div",[i("van-field",{attrs:{required:"",label:"逝者姓名",placeholder:"请输入姓名",rules:[{required:!0,message:"请填写姓名"}]},model:{value:e.dataForm.people[a].username,callback:function(t){e.$set(e.dataForm.people[a],"username",t)},expression:"dataForm.people[index].username"}}),i("van-field",{attrs:{readonly:"",clickable:"",name:"sex",value:e.dataForm.people[a].sex,label:"逝者性别",placeholder:"点击选择性别"},on:{click:function(t){return e.sexs(a)}}}),i("van-field",{attrs:{readonly:"",clickable:"",name:"datetimePicker",value:e.dataForm.people[a].birthday,label:"出生年月",placeholder:"点击选择日期"},on:{click:function(t){return e.birthday(a)}}}),i("van-field",{attrs:{readonly:"",clickable:"",name:"datetimePicker",value:e.dataForm.people[a].dieday,"min-date":e.minDates,label:"逝世年月",placeholder:"点击选择日期"},on:{click:function(t){return e.dead(a)}}}),i("van-field",{attrs:{rows:"2",autosize:"",label:"生平简介",type:"textarea",placeholder:"请输入"},model:{value:e.dataForm.people[a].introduction,callback:function(t){e.$set(e.dataForm.people[a],"introduction",t)},expression:"dataForm.people[index].introduction"}})],1)})),e.round<2?i("van-cell",{staticClass:"add-bury",on:{click:e.addBury}},[i("template",{slot:"title"},[i("van-icon",{staticClass:"ico_square",attrs:{name:"add-square"}}),i("span",{staticClass:"custom-title ico_square_txt"},[e._v("添加逝者")])],1)],2):e._e(),i("van-field",{attrs:{label:"纪念馆名称",placeholder:"请输入名称"},model:{value:e.dataForm.title,callback:function(t){e.$set(e.dataForm,"title",t)},expression:"dataForm.title"}}),i("van-field",{attrs:{label:"对逝者寄语",placeholder:"请输入寄语"},model:{value:e.dataForm.sendword,callback:function(t){e.$set(e.dataForm,"sendword",t)},expression:"dataForm.sendword"}}),i("van-field",{attrs:{name:"uploader",label:"上传头像"},scopedSlots:e._u([{key:"input",fn:function(){return[i("van-uploader",{attrs:{"max-count":"1","after-read":e.afterRead},model:{value:e.uploader,callback:function(t){e.uploader=t},expression:"uploader"}})]},proxy:!0}])}),i("h3",{staticClass:"img-h3"},[e._v("选择背景")]),e._l(e.images,(function(t,a){return i("van-image",{key:a,class:{checked:a==e.imgIndex},staticStyle:{margin:"0 .7rem"},attrs:{width:"5rem",height:"5rem",fit:"cover",src:t},on:{click:function(t){return e.changeImg(a)}}})})),i("h3",{staticClass:"img-h3"},[e._v("选择音乐")]),i("div",{staticClass:"music"},e._l(e.music,(function(t,a){return i("van-tag",{key:a,staticClass:"music-btn",attrs:{color:"#f2826a",size:"large",plain:a!=e.musicIndex},on:{click:function(t){return e.changeList(a)}}},[e._v(e._s(t))])})),1),i("div",{staticStyle:{margin:"16px"}},["新建纪念馆"==e.title?i("van-button",{attrs:{round:"",block:"",type:"info"},on:{click:e.memorial_add}},[e._v("\n      提交\n    ")]):i("van-button",{attrs:{round:"",block:"",type:"info"},on:{click:e.memorial_edit}},[e._v("\n      确认修改\n    ")])],1),i("van-popup",{attrs:{position:"bottom"},model:{value:e.showPicker,callback:function(t){e.showPicker=t},expression:"showPicker"}},[i("van-datetime-picker",{attrs:{type:"date","min-date":e.minDate},on:{confirm:e.onConfirm,cancel:function(t){e.showPicker=!1}},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:e.showPickers,callback:function(t){e.showPickers=t},expression:"showPickers"}},[i("van-datetime-picker",{attrs:{type:"date","min-date":e.minDate},on:{confirm:e.onConfirms,cancel:function(t){e.showPickers=!1}},model:{value:e.currentDates,callback:function(t){e.currentDates=t},expression:"currentDates"}})],1),i("van-popup",{attrs:{position:"bottom"},model:{value:e.showsex,callback:function(t){e.showsex=t},expression:"showsex"}},[i("van-picker",{attrs:{"show-toolbar":"",columns:e.sex},on:{confirm:e.onConfirmsex,cancel:function(t){e.showsex=!1}}})],1)],2)],1)},n=[],o=(i("4ca5"),i("77e6"),i("5ab2"),i("cdbe"),i("e10e"),i("4aac"),i("ad86")),r=(i("6d57"),i("ff21"),i("6657"),i("08c6")),s=i("289c"),c=i("6bf2"),d=i.n(c),l=i("08c1"),u=i("8262");function m(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?m(Object(i),!0).forEach((function(t){Object(s["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var h={data:function(){return{list:{},round:[1],index:0,title:"",sendword:"",dataForm:{uid:"",id:"",mid:1,sid:1,title:"",sendword:"",vitrotype:"",people:[{username:"",sex:"",birthday:"",dieday:"",introduction:""}]},uploader:[],sex:["男","女"],minDate:new Date("1870/01/01"),minDates:new Date("2020/01/01"),currentDate:new Date("1950/01/01"),currentDates:new Date("2020/01/01"),showPicker:!1,showPickers:!1,showsex:!1,img:[],musice:[],images:[],music:[],musicIndex:0,imgIndex:0}},created:function(){this.jump(),this.getList(),this.title="新建纪念馆",this.$route.query.id&&this.handleUpdate(this.$route.query.id)},mounted:function(){},computed:p({},Object(l["e"])(["user_info"])),methods:{jump:function(){var e=this;this.user_info.realname&&this.user_info.mobile||r["a"].alert({title:"温馨提示",message:"\b创建纪念馆必须完善手机和姓名！"}).then((function(){e.$router.push({name:"userCenter"})}))},getList:function(){var e=this;Object(u["z"])().then((function(t){e.img=t.data[0].deploy,e.musice=t.data[1].deploy,e.dataForm.sid=e.img[0].id,e.dataForm.mid=e.musice[0].id,e.img.forEach((function(t){e.images.push(t.thumb)})),e.musice.forEach((function(t){e.music.push(t.title)}))}))},onClickLeft:function(){this.$router.back()},memorial_add:function(){var e=this;this.dataForm.uid=this.user_info.id,Object(u["d"])(this.dataForm).then((function(t){0===t.code&&(Object(o["a"])({message:"添加成功",duration:800}),e.$router.push({name:"memorial"}))}))},memorial_edit:function(){var e=this;Object(u["h"])(this.dataForm).then((function(t){0===t.code&&(Object(o["a"])({message:"添加成功",duration:800}),e.$router.push({name:"memorialPage",query:{id:e.$route.query.id}}))}))},handleUpdate:function(e){var t=this;this.title="修改纪念馆";var i={id:e,uid:this.user_info.id||2};Object(u["f"])(i).then((function(e){t.list=e.data,2===t.list.people.length&&t.addBury(),t.dataForm=Object.assign({},t.list),t.img.forEach((function(e,i){t.dataForm.sid==e.id&&(t.imgIndex=i)})),t.musice.forEach((function(e,i){t.dataForm.mid==e.id&&(t.musicIndex=i)})),t.uploader.push(t.list.vitrotype)}))},birthday:function(e){this.index=e,this.showPicker=!0},dead:function(e){this.index=e,this.showPickers=!0},sexs:function(e){this.index=e,this.showsex=!0},onConfirm:function(e){this.dataForm.people[this.index].birthday=d()(e).format("YYYY-MM-DD"),this.showPicker=!1},onConfirms:function(e){this.dataForm.people[this.index].dieday=d()(e).format("YYYY-MM-DD"),this.showPickers=!1},onConfirmsex:function(e){this.dataForm.people[this.index].sex=e,this.showsex=!1},changeList:function(e){this.musicIndex=e,this.dataForm.mid=this.musice[e].id},changeImg:function(e){this.imgIndex=e,this.dataForm.sid=this.img[e].id},afterRead:function(e){var t=new FormData;t.append("file",e.file),this.dataForm.vitrotype=e.content},addBury:function(){this.round=2,this.dataForm.people.push({username:"",sex:"",birthday:"",dieday:"",introduction:""})}}},f=h,b=(i("028a"),i("623f")),v=Object(b["a"])(f,a,n,!1,null,"2f24e560",null);t["default"]=v.exports}}]);